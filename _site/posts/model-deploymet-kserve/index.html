<!DOCTYPE html>









<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="en"
  
>

  <!--
  The Head
-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  

    

    

  

  

  

  
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.1" />
<meta property="og:title" content="Model Deployment with KServe and KServe Features" />
<meta name="author" content="Raahul Dutta" />
<meta property="og:locale" content="en" />
<meta name="description" content="On a Friday Evening, Mid-September 2019 - Coworkers were leaving the office. The evening was welcoming a bright night. And I was working to deploy the LSTM models on production. I knew - “don’t deploy anything on Friday”. But I rejected the guidance. I applied a small change on production Friday morning. Unfortunately, the model was not serving any requests due to poor infrastructure. At midnight - I was able to deploy the models perfectly. While returning home - I was sharing the bus with the returned party hoppers. You feel the pain right?" />
<meta property="og:description" content="On a Friday Evening, Mid-September 2019 - Coworkers were leaving the office. The evening was welcoming a bright night. And I was working to deploy the LSTM models on production. I knew - “don’t deploy anything on Friday”. But I rejected the guidance. I applied a small change on production Friday morning. Unfortunately, the model was not serving any requests due to poor infrastructure. At midnight - I was able to deploy the models perfectly. While returning home - I was sharing the bus with the returned party hoppers. You feel the pain right?" />
<link rel="canonical" href="http://localhost:4000/posts/model-deploymet-kserve/" />
<meta property="og:url" content="http://localhost:4000/posts/model-deploymet-kserve/" />
<meta property="og:site_name" content="Musings on AI" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-11-20T00:32:00+01:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Model Deployment with KServe and KServe Features" />
<meta name="twitter:site" content="@raahul_rahl" />
<meta name="twitter:creator" content="@raahul_rahl" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Raahul Dutta","url":"https://www.linkedin.com/in/raahuldutta/"},"dateModified":"2022-11-20T00:32:00+01:00","datePublished":"2022-11-20T00:32:00+01:00","description":"On a Friday Evening, Mid-September 2019 - Coworkers were leaving the office. The evening was welcoming a bright night. And I was working to deploy the LSTM models on production. I knew - “don’t deploy anything on Friday”. But I rejected the guidance. I applied a small change on production Friday morning. Unfortunately, the model was not serving any requests due to poor infrastructure. At midnight - I was able to deploy the models perfectly. While returning home - I was sharing the bus with the returned party hoppers. You feel the pain right?","headline":"Model Deployment with KServe and KServe Features","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/model-deploymet-kserve/"},"url":"http://localhost:4000/posts/model-deploymet-kserve/"}</script>
<!-- End Jekyll SEO tag -->

  

  <title>Model Deployment with KServe and KServe Features | Musings on AI
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Musings on AI">
<meta name="application-name" content="Musings on AI">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  

    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin>
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
    

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">

  

  <!-- GA -->
  

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css">

  <link rel="stylesheet" href="/assets/css/style.css">

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css">
  

  
    <!-- Manific Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css">
  

  <!-- JavaScript -->

  <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>

  
    <!--
  Switch the mode between dark and light.
-->

<script type="text/javascript">
  class ModeToggle {
    static get MODE_KEY() { return "mode"; }
    static get MODE_ATTR() { return "data-mode"; }
    static get DARK_MODE() { return "dark"; }
    static get LIGHT_MODE() { return "light"; }
    static get ID() { return "mode-toggle"; }

    constructor() {
      if (this.hasMode) {
        if (this.isDarkMode) {
          if (!this.isSysDarkPrefer) {
            this.setDark();
          }
        } else {
          if (this.isSysDarkPrefer) {
            this.setLight();
          }
        }
      }

      let self = this;

      /* always follow the system prefers */
      this.sysDarkPrefers.addEventListener("change", () => {
        if (self.hasMode) {
          if (self.isDarkMode) {
            if (!self.isSysDarkPrefer) {
              self.setDark();
            }

          } else {
            if (self.isSysDarkPrefer) {
              self.setLight();
            }
          }

          self.clearMode();
        }

        self.notify();

      });

    } /* constructor() */

    get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); }

    get isSysDarkPrefer() { return this.sysDarkPrefers.matches; }

    get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; }

    get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; }

    get hasMode() { return this.mode != null; }

    get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); }

    /* get the current mode on screen */
    get modeStatus() {
      if (this.isDarkMode
        || (!this.hasMode && this.isSysDarkPrefer)) {
        return ModeToggle.DARK_MODE;
      } else {
        return ModeToggle.LIGHT_MODE;
      }
    }

    setDark() {
      $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
    }

    setLight() {
      $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
    }

    clearMode() {
      $('html').removeAttr(ModeToggle.MODE_ATTR);
      sessionStorage.removeItem(ModeToggle.MODE_KEY);
    }

    /* Notify another plugins that the theme mode has changed */
    notify() {
      window.postMessage({
        direction: ModeToggle.ID,
        message: this.modeStatus
      }, "*");
    }

  } /* ModeToggle */

  const toggle = new ModeToggle();

  function flipMode() {
    if (toggle.hasMode) {
      if (toggle.isSysDarkPrefer) {
        if (toggle.isLightMode) {
          toggle.clearMode();
        } else {
          toggle.setLight();
        }

      } else {
        if (toggle.isDarkMode) {
          toggle.clearMode();
        } else {
          toggle.setDark();
        }
      }

    } else {
      if (toggle.isSysDarkPrefer) {
        toggle.setLight();
      } else {
        toggle.setDark();
      }
    }

    toggle.notify();

  } /* flipMode() */

</script>

  
</head>


  <body data-spy="scroll" data-target="#toc" data-topbar-visible="true">

    <!--
  The Side Bar
-->

<div id="sidebar" class="d-flex flex-column align-items-end">
  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/" class="mx-auto">
        
          
          <img src="https://raw.githubusercontent.com/raahuldutta/musingsonai_img/master/raahul.png" alt="avatar" onerror="this.style.display='none'">
        
      </a>
    </div>

    <div class="site-title">
      <a href="/">Musings on AI</a>
    </div>
    <div class="site-subtitle font-italic">This is Musings on AI, a newsletter about I post weekly newsletters on the hottest Musings on Artificial Intelligence.</div>

  </div><!-- .profile-wrapper -->

  <ul class="w-100">

    <!-- home -->
    <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>HOME</span>
      </a>
    </li>
    <!-- the real tabs -->
    
    <li class="nav-item">
      <a href="/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ARCHIVES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/about/" class="nav-link">
        <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ABOUT</span>
      </a>
    </li> <!-- .nav-item -->
    

  </ul> <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center">

    
      <button class="mode-toggle btn" aria-label="Switch Mode">
        <i class="fas fa-adjust"></i>
      </button>

      
        <span class="icon-border"></span>
      
    

    
      

      
      <a href="https://github.com/raahuldutta" aria-label="github"
        target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
      

    
      

      
      <a href="https://twitter.com/raahul_rahl" aria-label="twitter"
        target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
      

    
      

      
      <a href="
          javascript:location.href = 'mailto:' + ['dutta.raahul','gmail.com'].join('@')" aria-label="email"
        >
        <i class="fas fa-envelope"></i>
      </a>
      

    
      

      
      <a href="" aria-label="mastodon"
        target="_blank" rel="noopener">
        <i class="fab fa-mastodon"></i>
      </a>
      

    
      

      
      <a href="" aria-label="linkedin"
        target="_blank" rel="noopener">
        <i class="fab fa-linkedin"></i>
      </a>
      

    

  </div> <!-- .sidebar-bottom -->

</div><!-- #sidebar -->


    <!--
  The Top Bar
-->

<div id="topbar-wrapper">
  <div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4">
    <span id="breadcrumb">

    

    

      

        
          <span>
            <a href="/">
              Home
            </a>
          </span>

        

      

        

      

        

          
            <span>Model Deployment with KServe and KServe Features</span>
          

        

      

    

    </span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">
      Post
    </div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" autocomplete="off" placeholder="Search...">
    </span>
    <span id="search-cancel" >Cancel</span>
  </div>

</div>


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div id="main" class="container pl-xl-4 pr-xl-4">
        





<div class="row">

  <!-- core -->
  <div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4">
    <div class="post pl-1 pr-1 pl-md-2 pr-md-2">

    

    
      
      
        <!--
  Refactor the HTML structure.
-->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->


<!-- images -->




  
  

  
    
      
      
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      

      
      

      

      
        

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      

      
      

      

      
        

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      

      
      

      

      
        

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      

      
      

      

      
        

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      

      
      

      

      
        

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      

      
      

      

      
        

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      

      
      

      

      
        

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  
    

    
    
    

    
    

    
    
    

    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      

      
      

      

      
    
      
      

      
      

      

      
        

    
      

        <!-- Add CDN URL -->
        

        <!-- Add image path -->
        

        
        

      

      <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

      

    

    <!-- Add SVG placehoder to prevent layout reflow -->

    

    <!-- Bypass the HTML-proofer test -->
    

    

  

  



<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    

    

  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    

    

  

  
  

  

  
  

  




<!-- Wrap prompt element of blockquote with the <div> tag -->







  
  

  

    
      
      

    

    
    

    
    
    

    
      
        
        

    

    
    

    

  

    

    
    

    
    
    

    
      
        
        

    

    
    

    

  

  



<!-- return -->

<h1 data-toc-skip>Model Deployment with KServe and KServe Features</h1>

<div class="post-meta text-muted">
    <!-- published date -->
    <span>
      Posted
      <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class=""
    data-ts="1668900720"
    data-df="ll"
    data-toggle="tooltip" data-placement="bottom">
  Nov 20, 2022
</em>

    </span>

    <!-- lastmod date -->
    

  

  <div class="d-flex justify-content-between">
    <!-- author(s) -->
    <span>
      

      By

      <em>
      
        
          <a href="https://www.linkedin.com/in/raahuldutta/">Raahul Dutta</a>
          
        
      
      </em>
    </span>

    <div>
      <!-- page views -->
      

      <!-- read time -->
      <!--
  Calculate the post's reading time, and display the word count in tooltip
 -->



<!-- words per minute  -->










<!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom"
  title="1506 words">
  <em>8 min</em> read</span>

    </div>

  </div> <!-- .d-flex -->

</div> <!-- .post-meta -->

<div class="post-content">
  <p>On a Friday Evening, Mid-September 2019 - Coworkers were leaving the office. The evening was welcoming a bright night. And I was working to deploy the LSTM models on production. I knew - “don’t deploy anything on Friday”. But I rejected the guidance. I applied a small change on production Friday morning. Unfortunately, the model was not serving any requests due to poor infrastructure. At midnight - I was able to deploy the models perfectly. While returning home - I was sharing the bus with the returned party hoppers. You feel the pain right?</p>

<p>Now, It’s 2022. The little hummingbird has fluttered her wings 7.5 billion times in the last three years. And We have now a simple pluggable solution for many burning machine learning problems like:</p>
<ul>
  <li>Cost: Is the model over or under-scaled? Are resources being used efficiently?</li>
  <li>Monitoring: Are all the endpoints healthy? What is the performance profile and request trace?</li>
  <li>Rollouts: Is this rollout safe? How do I roll back? Can I test a change without swapping traffic?</li>
  <li>Protocol Standards: How do I make a prediction? GRPC? HTTP? Kafka</li>
  <li>How do I handle batch predictions?</li>
  <li>How do I leverage standardized Data Plane protocol so that I can move the model across MLServing Platforms?</li>
  <li>How do I serve Tensorflow, Xgboost, and Pytorch on the same infrastructure?</li>
  <li>How do I explain predictions?</li>
  <li>How do I wire up custom pre and post-processing?</li>
</ul>

<p>And the Answer is KServe.</p>
<ul>
  <li>KServe is a Model Inferencing Platform on Kubernetes.</li>
  <li>Run Anywhere Kubernetes runs. Provides Performant, Standardized inference protocol across ML Frameworks.</li>
  <li>Support modern serverless inference workload with Autoscaling including a scale to zero on GPU.</li>
  <li>Simple and Pluggable Production Serving including Prediction, pre/post-processing, monitoring, and explainable.</li>
  <li>Advanced deployments with Canary rollout, transformers, experiments, ensembles, and Model-Mesh.</li>
</ul>

<p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 616 557'%3E%3C/svg%3E" data-src="https://raw.githubusercontent.com/raahuldutta/musingsonai_img/master/posts/202201119/kserve1.png" alt="kserve" width="616" height="557" data-proofer-ignore></p>

<p>This image is not related with Kserve - Got the picture from reddit, its not an actual view.The picture was generated with the diffusion model.</p>

<h2 id="starting-kserve-on-eks"><span class="mr-2">Starting KServe on EKS</span><a href="#starting-kserve-on-eks" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>We need a cluster with K8 version <code class="language-plaintext highlighter-rouge">1.22(minimum)</code>. We created a cluster called <code class="language-plaintext highlighter-rouge">dataplatform-sandbox_ml</code> to execute the exploration of KServe.</p>

<h3 id="local-installation"><span class="mr-2">Local Installation</span><a href="#local-installation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>If you are exploring on the local machine - you can install Minikube.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>curl <span class="nt">-LO</span> https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64
<span class="nb">sudo install </span>minikube-linux-amd64 /usr/local/bin/minikube
minikube start <span class="nt">--memory</span><span class="o">=</span>max <span class="nt">--cpus</span><span class="o">=</span>max
minikube tunnel
<span class="c">#open a new terminal</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="kubernetes-installation"><span class="mr-2">Kubernetes Installation</span><a href="#kubernetes-installation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>curl <span class="nt">-LO</span> <span class="s2">"https://storage.googleapis.com/kubernetes-release/release/</span><span class="si">$(</span>curl <span class="nt">-s</span> https://storage.googleapis.com/kubernetes-release/release/stable.txt<span class="si">)</span><span class="s2">/bin/linux/amd64/kubectl"</span>
<span class="nb">chmod</span> +x ./kubectl
<span class="nb">sudo mv</span> ./kubectl /usr/local/bin/kubectl
kubectl cluster-info
</pre></td></tr></tbody></table></code></div></div>

<h3 id="kserve-installation"><span class="mr-2">KServe Installation</span><a href="#kserve-installation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Execute the Hack File:</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>curl <span class="nt">-s</span> <span class="s2">"https://raw.githubusercontent.com/kserve/kserve/master/hack/quick_install.sh"</span> | bash
</pre></td></tr></tbody></table></code></div></div>

<p>Expected Output:</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="s2">"😀 Successfully installed Istio”
"</span>😀 Successfully installed Knative<span class="s2">" 
"</span>😀 Successfully installed Cert Manager”
<span class="s2">"😀 Successfully installed KServe”
</span></pre></td></tr></tbody></table></code></div></div>

<p>The Version Matrix</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th style="text-align: left">Component</th>
      <th style="text-align: left">Version</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Knative</td>
      <td style="text-align: left">1.4.0</td>
    </tr>
    <tr>
      <td style="text-align: left">Cert Manager Version</td>
      <td style="text-align: left">1.14.0</td>
    </tr>
    <tr>
      <td style="text-align: left">Istio</td>
      <td style="text-align: left">Giovanni Rovelli</td>
    </tr>
    <tr>
      <td style="text-align: left">Kserve</td>
      <td style="text-align: left">0.9</td>
    </tr>
  </tbody>
</table></div>

<h2 id="prerequisite-model-training"><span class="mr-2">Prerequisite: Model Training</span><a href="#prerequisite-model-training" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="nv">inference_address</span><span class="o">=</span>http://0.0.0.0:8085
<span class="nv">management_address</span><span class="o">=</span>http://0.0.0.0:8085
<span class="nv">metrics_address</span><span class="o">=</span>http://0.0.0.0:8082
<span class="nv">grpc_inference_port</span><span class="o">=</span>7070
<span class="nv">grpc_management_port</span><span class="o">=</span>7071
<span class="nv">enable_metrics_api</span><span class="o">=</span><span class="nb">true
</span><span class="nv">metrics_format</span><span class="o">=</span>prometheus
<span class="nv">number_of_netty_threads</span><span class="o">=</span>4
<span class="nv">job_queue_size</span><span class="o">=</span>10
<span class="nv">enable_envvars_config</span><span class="o">=</span><span class="nb">true
</span><span class="nv">install_py_dep_per_model</span><span class="o">=</span><span class="nb">false
</span><span class="nv">service_envelope</span><span class="o">=</span>body
<span class="nv">model_store</span><span class="o">=</span>/mnt/models/model-store
<span class="nv">model_snapshot</span><span class="o">={</span><span class="s2">"name"</span>:<span class="s2">"startup.cfg"</span>,<span class="s2">"modelCount"</span>:1,<span class="s2">"models"</span>:<span class="o">{</span><span class="s2">"SciBERTSeqClassification"</span>:<span class="o">{</span><span class="s2">"1.0"</span>:<span class="o">{</span><span class="s2">"defaultVersion"</span>:true,<span class="s2">"marName"</span>:<span class="s2">"SciBERTSeqClassification.mar"</span>,<span class="s2">"minWorkers"</span>:1,<span class="s2">"maxWorkers"</span>:2,<span class="s2">"batchSize"</span>:4,<span class="s2">"maxBatchDelay"</span>:1000,<span class="s2">"responseTimeout"</span>:120<span class="o">}}}}</span>
</pre></td></tr></tbody></table></code></div></div>

<h2 id="model-storage"><span class="mr-2">Model Storage</span><a href="#model-storage" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>KServe supports Azure, hdfs, PVC, S3, URI, storageSpec.
We explored PVC ( Persistent Volume Claim) and S3 to store the models. The creation of PV and PVC and the Transfer of the model to PV have been covered here.</p>

<h2 id="captum-explanations"><span class="mr-2">Captum Explanations</span><a href="#captum-explanations" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>In order to understand the word importances and attributions when we make an explanation Request, we use Captum Insights for the HuggingFace Transformers pre-trained model.</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre>curl <span class="nt">--location</span> <span class="nt">--request</span> POST <span class="s1">'http://${INGRESS_HOST}:${INGRESS_PORT}/v2/models/${MODEL_NAME}/explain'</span> 
<span class="nt">--header</span> <span class="s1">'Host: ${SERVICE_HOSTNAME}'</span> 
<span class="nt">--header</span> <span class="s1">'Content-Type: application/json'</span>
<span class="nt">--data-raw</span> <span class="s1">'{
"id": "d3b15cad-50a2-4eaf-80ce-8b0a428bd298",
"inputs": [{
"name": "4b7c7d4a-51e4-43c8-af61-04639f6ef4bc",
"shape": -1,
"datatype": "BYTES",
"data": "{"text":"Risk assessment implications."}"
}
]
}'</span>
</pre></td></tr></tbody></table></code></div></div>
<p>Expected Output</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="o">{</span><span class="s2">"id"</span>: <span class="s2">"d3b15cad-50a2-4eaf-80ce-8b0a428bd298"</span>, <span class="s2">"model_name"</span>: <span class="s2">"SciBERTSeqClassification"</span>, <span class="s2">"model_version"</span>: <span class="s2">"1.0"</span>, <span class="s2">"outputs"</span>: <span class="o">[{</span><span class="s2">"name"</span>: <span class="s2">"explain"</span>, <span class="s2">"shape"</span>: <span class="o">[]</span>, <span class="s2">"datatype"</span>: <span class="s2">"BYTES"</span>, <span class="s2">"data"</span>: <span class="o">[{</span><span class="s2">"words"</span>: <span class="o">[</span><span class="s2">"[CLS]"</span>, <span class="s2">"Risk"</span>, <span class="s2">"assessment"</span>, <span class="s2">"implications"</span>, <span class="s2">"of"</span>, <span class="s2">"site-specific"</span>, <span class="s2">"oral"</span>, <span class="s2">"relative"</span>, <span class="s2">"bioavailability"</span>, <span class="s2">"."</span>, <span class="s2">"[SEP]"</span><span class="o">]</span>, <span class="s2">"importances"</span>: <span class="o">[</span>0.0, <span class="nt">-0</span>.43571255624310423, <span class="nt">-0</span>.11062097534384648, 0.11323803203829622, 0.05438679692935377, <span class="nt">-0</span>.11364841625009202, 0.15214504085858935, <span class="nt">-0</span>.0013061684457894148, 0.05712844103997178, <span class="nt">-0</span>.02296408323390218, 0.1937543236757826, <span class="nt">-0</span>.12138265438655091, 0.20713335609474381, <span class="nt">-0</span>.8044260616647264, 0.0], <span class="s2">"delta"</span>: <span class="nt">-0</span>.019047775223331675<span class="o">}]}]}</span>
</pre></td></tr></tbody></table></code></div></div>

<blockquote class="prompt-tip"><div>
  <p>The first BERT model has been deployed. Let’s take a break. 
Afterward, we will learn about some of the important features of KServe.</p>
</div></blockquote>

<blockquote class="prompt-tip"><div>
  <p>I hope you have enjoyed the Coffee. I read somewhere a nice coffee joke - 
<em>What’s the best Beatles’ song to play at a coffee shop? Latte Be!</em>
Let’s try some important features of KServe.</p>
</div></blockquote>

<h2 id="inference-batching"><span class="mr-2">Inference Batching</span><a href="#inference-batching" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>KServe supports batch prediction for any ML framework (TensorFlow, PyTorch, …) without decreasing the performance.</p>

<p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 616 557'%3E%3C/svg%3E" data-src="https://raw.githubusercontent.com/raahuldutta/musingsonai_img/master/posts/202201119/ib.png" alt="kserve" width="616" height="557" data-proofer-ignore></p>

<p>This batcher is implemented in the KServe model agent sidecar, so the requests first hit the agent sidecar, when a batch prediction is triggered the request is then sent to the model server container for inference.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">maxBatchSize</code>: the max batch size for triggering a prediction.</li>
  <li><code class="language-plaintext highlighter-rouge">maxLatency</code>: the max latency for triggering a prediction (In milliseconds).</li>
  <li><code class="language-plaintext highlighter-rouge">timeout</code>: timeout of calling predictor service (In seconds).</li>
</ul>

<p>All of the fields have default values in the code. You can config them or not as you wish.</p>

<div class="language-yaml highlighter-rouge"><div class="code-header">
        <span data-label-text="YAML"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s2">"</span><span class="s">serving.kserve.io/v1beta1"</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s2">"</span><span class="s">InferenceService"</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">scibert"</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">predictor</span><span class="pi">:</span>
    <span class="na">timeout</span><span class="pi">:</span> <span class="m">60</span>
    <span class="na">batcher</span><span class="pi">:</span>
      <span class="na">maxBatchSize</span><span class="pi">:</span> <span class="m">32</span>
      <span class="na">maxLatency</span><span class="pi">:</span> <span class="m">5000</span>
    <span class="na">model</span><span class="pi">:</span>
      <span class="na">modelFormat</span><span class="pi">:</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">pytorch</span>
      <span class="na">protocolVersion</span><span class="pi">:</span> <span class="s">v2</span>
      <span class="na">storageUri</span><span class="pi">:</span> <span class="s">pvc://task-pv-claim/models</span>
</pre></td></tr></tbody></table></code></div></div>

<p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 616 557'%3E%3C/svg%3E" data-src="https://raw.githubusercontent.com/raahuldutta/musingsonai_img/master/posts/202201119/kserve2.png" alt="kserve" width="616" height="557" data-proofer-ignore></p>

<p>This image is not related with Kserve - Got the picture from reddit, its not an actual view.The picture was generated with the diffusion model.</p>

<h2 id="canary-rollout"><span class="mr-2">Canary Rollout</span><a href="#canary-rollout" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Canary rollout is a deployment strategy when you can release a new version of model to a small percent of the production traffic.
Lets deploy the below yaml files on your cluster with the new version.</p>

<p>apiVersion: “serving.kserve.io/v1beta1”
kind: “InferenceService”
metadata:
  name: “torchserve”
spec:
  predictor:
    model:
      modelFormat:
        name: pytorch
      protocolVersion: v2<br />
      storageUri: gs://kfserving-examples/models/torchserve/image_classifier/v2</p>

<p>apiVersion: “serving.kserve.io/v1beta1”
kind: “InferenceService”
metadata:
  name: “torchserve”
spec:
  predictor:
    canaryTrafficPercent: 20
    model:
      modelFormat:
        name: pytorch
      protocolVersion: v2<br />
      storageUri: gs://kfserving-examples/models/torchserve/image_classifier/v2</p>

<p>kubectl get revisions -l serving.kserve.io/inferenceservice=torchserve
NAME                                 CONFIG NAME                    K8S SERVICE NAME   GENERATION   READY   REASON   ACTUAL REPLICAS   DESIRED REPLICAS
torchserve-predictor-default-00001   torchserve-predictor-default                      1            True             1                 1
torchserve-predictor-default-00002   torchserve-predictor-default                      2            True             1                 1</p>

<p>kubectl get pods -l serving.kserve.io/inferenceservice=torchserve
NAME                                                             READY   STATUS    RESTARTS   AGE
torchserve-predictor-default-00001-deployment-7d99979c99-p49gk   2/2     Running   0          28m
torchserve-predictor-default-00002-deployment-c6fcc65dd-rjknq    2/2     Running   0          3m37s</p>

<p>SERVICE_HOSTNAME=$(kubectl get inferenceservice torchserve -o jsonpath=’{.status.url}’ | cut -d “/” -f 3)
CLUSTER_IP=$(kubectl -n istio-system get service istio-ingressgateway -o jsonpath=’{.status.loadBalancer.ingress[0].hostname}’)
for i in {1..10}; do curl -H “Host: ${SERVICE_HOSTNAME}” http://${CLUSTER_IP}/v2/models/mnist/infer -d @./canary_input.json; done</p>

<p>{“predictions”: [2]}Handling connection for 8080
{“predictions”: [2]}Handling connection for 8080
{“predictions”: [2]}Handling connection for 8080</p>
<html><title>500: Internal Server Error</title><body>500: Internal Server Error</body></html>
<p>Handling connection for 8080</p>
<html><title>500: Internal Server Error</title><body>500: Internal Server Error</body></html>
<p>Handling connection for 8080
{“predictions”: [2]}Handling connection for 8080
{“predictions”: [2]}Handling connection for 8080
{“predictions”: [2]}Handling connection for 8080
{“predictions”: [2]}Handling connection for 8080
{“predictions”: [2]}Handling connection for 8080</p>

<h2 id="logging"><span class="mr-2">Logging</span><a href="#logging" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>We can add Prometheus and Grafana to the cluster to capture the model health. We need to add the prometheus.io/scrape and  <code class="language-plaintext highlighter-rouge">prometheus.io/port</code> under <code class="language-plaintext highlighter-rouge">annotations</code></p>

<div class="language-yaml highlighter-rouge"><div class="code-header">
        <span data-label-text="YAML"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s2">"</span><span class="s">serving.kserve.io/v1beta1"</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s2">"</span><span class="s">InferenceService"</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">scibert"</span>
  <span class="na">annotations</span><span class="pi">:</span>
    <span class="na">prometheus.io/scrape</span><span class="pi">:</span> <span class="s1">'</span><span class="s">true'</span>
    <span class="na">prometheus.io/port</span><span class="pi">:</span> <span class="s1">'</span><span class="s">8082'</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">predictor</span><span class="pi">:</span>
    <span class="na">timeout</span><span class="pi">:</span> <span class="m">60</span>
    <span class="na">batcher</span><span class="pi">:</span>
      <span class="na">maxBatchSize</span><span class="pi">:</span> <span class="m">32</span>
      <span class="na">maxLatency</span><span class="pi">:</span> <span class="m">5000</span>
    <span class="na">model</span><span class="pi">:</span>
      <span class="na">modelFormat</span><span class="pi">:</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">pytorch</span>
      <span class="na">protocolVersion</span><span class="pi">:</span> <span class="s">v2</span>
      <span class="na">storageUri</span><span class="pi">:</span> <span class="s">pvc://task-pv-claim/models</span>
</pre></td></tr></tbody></table></code></div></div>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
helm <span class="nb">install </span>prometheus prometheus-community/prometheus
kubectl expose service prometheus-server <span class="nt">--type</span><span class="o">=</span>NodePort <span class="nt">--target-port</span><span class="o">=</span>9090 <span class="nt">--name</span><span class="o">=</span>prometheus-server-npkubectl expose service prometheus-server <span class="nt">--type</span><span class="o">=</span>NodePort <span class="nt">--target-port</span><span class="o">=</span>9090 <span class="nt">--name</span><span class="o">=</span>prometheus-server-np
</pre></td></tr></tbody></table></code></div></div>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>helm repo add grafana https://grafana.github.io/helm-charts
helm <span class="nb">install </span>my-release grafana/grafana
kubectl get secret <span class="nt">--namespace</span> default my-release-grafana <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s2">"{.data.admin-password}"</span> | <span class="nb">base64</span> <span class="nt">--decode</span> <span class="p">;</span> <span class="nb">echo
export </span><span class="nv">POD_NAME</span><span class="o">=</span><span class="si">$(</span>kubectl get pods <span class="nt">--namespace</span> default <span class="nt">-l</span> <span class="s2">"app.kubernetes.io/name=grafana,app.kubernetes.io/instance=my-release"</span> <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s2">"{.items[0].metadata.name}"</span><span class="si">)</span>
kubectl <span class="nt">--namespace</span> default port-forward <span class="nv">$POD_NAME</span> 3000
</pre></td></tr></tbody></table></code></div></div>

<h2 id="auto-scaling"><span class="mr-2">Auto-Scaling</span><a href="#auto-scaling" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>KServe supports the implementation of Knative Pod Autoscaler (KPA) and Kubernetes’ Horizontal Pod Autoscaler (HPA).</p>

<p>We can configure InferenceService with field containerConcurrency for a hard limit. The hard limit is an enforced upper bound. If concurrency reaches the hard limit, surplus requests will be buffered and must wait until enough capacity is free to execute the requests.</p>

<p>We configure InferenceService with annotation autoscaling.knative.dev/target for a soft limit. The soft limit is a targeted limit rather than a strictly enforced bound, particularly if there is a sudden burst of requests, this value can be exceeded.</p>

<p>I deployed <code class="language-plaintext highlighter-rouge">triton.yaml</code> on EKS cluster to explore the Autoscaling and I used <code class="language-plaintext highlighter-rouge">hey</code> to send loads.</p>

<div class="language-yaml highlighter-rouge"><div class="code-header">
        <span data-label-text="YAML"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre></td><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s2">"</span><span class="s">serving.kserve.io/v1beta1"</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s2">"</span><span class="s">InferenceService"</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">triton-gpu</span>
  <span class="na">annotations</span><span class="pi">:</span>
    <span class="na">prometheus.io/scrape</span><span class="pi">:</span> <span class="s1">'</span><span class="s">true'</span>
    <span class="na">prometheus.io/port</span><span class="pi">:</span> <span class="s1">'</span><span class="s">8082'</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">predictor</span><span class="pi">:</span>
    <span class="na">timeout</span><span class="pi">:</span> <span class="m">1</span>
    <span class="na">batcher</span><span class="pi">:</span>
      <span class="na">maxBatchSize</span><span class="pi">:</span> <span class="m">32</span>
      <span class="na">maxLatency</span><span class="pi">:</span> <span class="m">5000</span>
    <span class="na">containers</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">username</span><span class="pi">}</span><span class="s">/triton-tensorrt-gpu-predictor:latest</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">triton-container</span>
      <span class="na">env</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">OMP_NUM_THREADS</span>
        <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1"</span>
      <span class="na">resources</span><span class="pi">:</span>
        <span class="na">limits</span><span class="pi">:</span>
          <span class="na">nvidia.com/gpu</span><span class="pi">:</span> <span class="m">1</span>
        <span class="na">requests</span><span class="pi">:</span>
          <span class="na">nvidia.com/gpu</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">transformer</span><span class="pi">:</span>
    <span class="na">containers</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">username</span><span class="pi">}</span><span class="s">/triton-tensorrt-transformer:latest</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">kfserving-container</span>
      <span class="na">command</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">python"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">-m"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">bert_tokenizer"</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Sample Json file :</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="o">{</span>
    <span class="s2">"instances"</span>:[
        <span class="o">{</span>
            <span class="s2">"text"</span> : <span class="s2">"Risk assessment implications of site-specific oral relative bioavailability."</span>
        <span class="o">}</span>
    <span class="o">]</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="hey-installation"><span class="mr-2">Hey Installation</span><a href="#hey-installation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>go <span class="nb">install </span>github.com/rakyll/hey@latest
hey <span class="nt">-m</span> POST <span class="nt">-z</span> 60s <span class="nt">-D</span> ./triton_sample.json <span class="nt">-host</span> triton-gpu.default.example.com http://a6907a1015c574abc96a2e47036d54c5-903913666.us-east-2.elb.amazonaws.com/v1/models/transformer_tensorrt_inference:predict
</pre></td></tr></tbody></table></code></div></div>

<h3 id="execution-results"><span class="mr-2">Execution Results</span><a href="#execution-results" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<ul>
  <li>
    <p>Before the “Hey” Execution - Single pod of transformer and predictor is live.
<img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 616 557'%3E%3C/svg%3E" data-src="https://raw.githubusercontent.com/raahuldutta/musingsonai_img/master/posts/202201119/as1.png" alt="kserve" width="616" height="557" data-proofer-ignore></p>
  </li>
  <li>
    <p>After 2 Seconds - pods are warming up
<img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 616 557'%3E%3C/svg%3E" data-src="https://raw.githubusercontent.com/raahuldutta/musingsonai_img/master/posts/202201119/as2.png" alt="kserve" width="616" height="557" data-proofer-ignore></p>
  </li>
  <li>
    <p>After 30 Seconds - pods are running
<img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 616 557'%3E%3C/svg%3E" data-src="https://raw.githubusercontent.com/raahuldutta/musingsonai_img/master/posts/202201119/as3.png" alt="kserve" width="616" height="557" data-proofer-ignore></p>
  </li>
  <li>
    <p>After 70 Seconds - bomberding done. pods are dying
<img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 616 557'%3E%3C/svg%3E" data-src="https://raw.githubusercontent.com/raahuldutta/musingsonai_img/master/posts/202201119/as4.png" alt="kserve" width="616" height="557" data-proofer-ignore></p>
  </li>
  <li>
    <p>After 90 Seconds - back square 1
<img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 616 557'%3E%3C/svg%3E" data-src="https://raw.githubusercontent.com/raahuldutta/musingsonai_img/master/posts/202201119/as5.png" alt="kserve" width="616" height="557" data-proofer-ignore></p>
  </li>
</ul>

</div>

<div class="post-tail-wrapper text-muted">

  <!-- categories -->
  

  <!-- tags -->
  

  <div class="post-tail-bottom
    d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
    <div class="license-wrapper">

      

        

        This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.

      
    </div>

    <!--
 Post sharing snippet
-->

<div class="share-wrapper">
  <span class="share-label text-muted mr-1">Share</span>
  <span class="share-icons">
    
    
    

    
      
        <a href="https://twitter.com/intent/tweet?text=Model+Deployment+with+KServe+and+KServe+Features+-+Musings+on+AI&url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fmodel-deploymet-kserve%2F" data-toggle="tooltip" data-placement="top"
          title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a>
    
      
        <a href="https://www.facebook.com/sharer/sharer.php?title=Model+Deployment+with+KServe+and+KServe+Features+-+Musings+on+AI&u=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fmodel-deploymet-kserve%2F" data-toggle="tooltip" data-placement="top"
          title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a>
    
      
        <a href="https://t.me/share/url?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fmodel-deploymet-kserve%2F&text=Model+Deployment+with+KServe+and+KServe+Features+-+Musings+on+AI" data-toggle="tooltip" data-placement="top"
          title="Telegram" target="_blank" rel="noopener" aria-label="Telegram">
          <i class="fa-fw fab fa-telegram"></i>
        </a>
    
      
        <a href="https://www.linkedin.com/sharing/share-offsite/?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fmodel-deploymet-kserve%2F" data-toggle="tooltip" data-placement="top"
          title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin">
          <i class="fa-fw fab fa-linkedin"></i>
        </a>
    

    <i id="copy-link" class="fa-fw fas fa-link small"
        data-toggle="tooltip" data-placement="top"
        title="Copy link"
        data-title-succeed="Link copied successfully!">
    </i>

  </span>
</div>


  </div><!-- .post-tail-bottom -->

</div><!-- div.post-tail-wrapper -->


      
    
    

    </div>
  </div> <!-- #core-wrapper -->

  <!-- panel -->
  <div id="panel-wrapper" class="col-xl-3 pl-2 text-muted">

    <div class="access">
      















  <div id="access-lastmod" class="post">
    <div class="panel-heading"></div>
    <ul class="post-content pl-0 pb-1 ml-1 mt-2">
      
        
        
        
      <li><a href="/posts/how-to-select-right-gpu-instance-aws/">How to Select the Right GPU Instance for Your Team on AWS?</a></li>
      
    </ul>
  </div> <!-- #access-lastmod -->



      


















    </div>

    
      
      



<!-- BS-toc.js will be loaded at medium priority -->
<script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script>

<div id="toc-wrapper" class="pl-0 pr-4 mb-5">
  <div class="panel-heading pl-3 pt-2 mb-2">Contents</div>
  <nav id="toc" data-toggle="toc"></nav>
</div>


    
  </div>

</div>

<!-- tail -->

<div class="row">
  <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5">
    
      
      <!--
 Recommend the other 3 posts according to the tags and categories of the current post,
 if the number is not enough, use the other latest posts to supplement.
-->

<!-- The total size of related posts  -->


<!-- An random integer that bigger than 0  -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy}  -->








  

  
    
  

  

  

  

  

  








<!-- Fill with the other newlest posts  -->



  
    
    
  
    
    
      
      
        
        
        
      
    
  



  <div id="related-posts" class="mb-2 mb-sm-4">
    <h3 class="pt-2 mb-4 ml-1"
      data-toc-skip>Further Reading</h3>
    <div class="card-deck mb-4">
    
      
      
      <div class="card">
        <a href="/posts/how-to-select-right-gpu-instance-aws/">
          <div class="card-body">
            <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em class="small"
    data-ts="1668900720"
    data-df="ll"
    >
  Nov 20, 2022
</em>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>How to Select the Right GPU Instance for Your Team on AWS?</h3>
            <div class="text-muted small">
              <p>
                





                Imagination is the exaggeration of the data you have in your brain. I want to train a diffusion model to compose a piece of music on a lovely evening in Amsterdam. But I require an AWS GPU instance...
              </p>
            </div>
          </div>
        </a>
      </div>
    
    </div> <!-- .card-deck -->
  </div> <!-- #related-posts -->


    
      
      <!--
  Navigation buttons at the bottom of the post.
-->

<div class="post-navigation d-flex justify-content-between">
  
  <a href="/posts/how-to-select-right-gpu-instance-aws/" class="btn btn-outline-primary"
    prompt="Older">
    <p>How to Select the Right GPU Instance for Your Team on AWS?</p>
  </a>
  

  
  <div class="btn btn-outline-primary disabled"
    prompt="Newer">
    <p>-</p>
  </div>
  

</div>

    
      
      <!--  The comments switcher -->


    
  </div>
</div>


      </div>

      <!--
  The Search results
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-sm-11 post-content">
    <div id="search-hints">
      


















    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>


    </div> <!-- #main-wrapper -->

    <!-- The Footer -->

<footer>
  <div class="container pl-lg-4 pr-lg-4">
    <div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3">
      <div class="footer-left">
        <p class="mb-0">
          © 2022
          <a href="https://twitter.com/raahul_rahl">Raahul Dutta</a>.
          
          <span data-toggle="tooltip" data-placement="top"
            title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span>
          
        </p>
      </div>

      <div class="footer-right">
        <p class="mb-0">

          

          

          Powered by 
          <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>
           with 
          <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a>
           theme.
        </p>
      </div>
    </div>
  </div>
</footer>


    

    <div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>

    
      <div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true"
        data-animation="true" data-autohide="false">
        <div class="toast-header">
          <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="toast-body text-center pt-0">
          <p class="pl-2 pr-2 mb-3">A new version of content is available.</p>
          <button type="button" class="btn btn-primary" aria-label="Update">
            Update
          </button>
        </div>
      </div>
    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No results found.</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }

    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>


    <!--
  JS selector for site.
-->

<!-- layout specified -->


  



  <!-- image lazy-loading & popup & clipboard -->
  

  







  
    

    

  



  
    

    

  



  
    

    

  




  <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script>







  

  

  







  
    

    

  



  
    

    

  



  
    

    

  



  
    

    

  




  <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script>








<script defer src="/assets/js/dist/post.min.js"></script>



<!-- commons -->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script>




  </body>

</html>
